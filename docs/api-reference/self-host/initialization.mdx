---
title: Initialization
hide_table_of_contents: false
displayed_sidebar: apiReference
---

---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

import ServiceProviderTorusExample from "./common/_service-provider-torus-example.mdx";
import ServiceProviderBaseExample from "./common/_service-provider-base-example.mdx";
import StorageLayerTorusExample from "./common/_storage-layer-torus-example.mdx";
import ModulesDescription from "./common/_modules-description.mdx";
import ModulesExample from "./common/_modules-example.mdx";

After Installation, the next step to use Web3Auth Self Host is to Initialize the SDK.

The Initialization is just a two step process for the base TKey, instantiation and initialisation 2 optional steps for adding various functionalities.
However, to enable the social login shares, we have 3 additional steps.

- [Configuration of Service Provider](#configuring-service-provider) _(recommended for social login shares)_
- [Configuration of Storage Layer](#configuring-storage-layer) _(optional)_
- [Configuration of Modules](#configuring-modules) _(optional)_
- **[Instantiation of tKey](#instantiating-tkey)**
- [Initialization of Torus Service Provider](#initializing-torus-service-provider) _(recommended for social login shares)_
- [Triggering Login using the Torus Service Provider](#triggering-login-using-torus-service-provider) _(recommended for social login shares)_
- **[Initialization of tKey](#initializing-tkey)**

Please note that these are the most critical steps where you need to pass on different parameters according to the pcommon of your project.
Additionally, Whitelabeling and Custom Authentication have to be configured within this step, if you wish to customise your Web3Auth Instance.

## Configuring Service Provider

---

For generating a [**Share B**](./introduction), ie. the private key share managed by a wallet service provider via their own authentication flows, you
need to use and configure one of the following modules:

### Torus Service Provider

#### [`@tkey/service-provider-torus`](./installation#torus-service-provider)

This package gives you the ability to use the Custom Auth SDK from Torus as a service provider for providing the **Share B** of the user, using their
social login accounts.

:::tip

Have a look at the [Service Provider Reference](./service-provider#torus-service-provider) to know more about `TorusServiceProvider` and its
configuration.

:::

#### Example

<ServiceProviderTorusExample />

### Base Service Provider

#### [`@tkey/service-provider-base`](./installation#base-service-provider)

This Base SDK that accepts a private key which can be used to create one of the shares the tkey. You can generate a private key from any wallet and
pass it over to this SDK for creating one of the shares.

:::tip

Have a look at the [Service Provider Reference](./service-provider#base-service-provider) to know more about `ServiceProvider` and its configuration.

:::

#### Example

<ServiceProviderBaseExample />

## Configuring Storage Layer

---

A storage layer is needed to store and recall the metadata information of the shares generated so as to be able to recover the private key from the
tkeys generated. For this we use the `@tkey/storage-layer-torus` SDK, which gives you the ability to get and set the Metadata for the various shares
generated.

:::info

You can either use the torus metadata server, or make your own server by cloning the
[`torus-metadata`](https://github.com/torusresearch/torus-metadata) repository.

:::

#### [`@tkey/storage-layer-torus`](./installation#tkeystorage-layer-torus)

#### Import the `TorusStorageLayer` class from `@tkey/storage-layer-torus`

```javascript
import TorusStorageLayer from "@tkey/storage-layer-torus";
```

#### Assign the `TorusStorageLayer` class to a variable

```javascript
const storageLayer = new TorusStorageLayer(TorusStorageLayerArgs);
```

### Parameters

#### `TorusStorageLayerArgs`

This `TorusStorageLayer` constructor takes an object with `TorusStorageLayerArgs` as input. It contains the following parameters:

<Tabs
  defaultValue="table"
  values={[
    { label: "Table", value: "table" },
    { label: "Type Reference", value: "type" },
  ]}
>

<TabItem value="table">

</TabItem>

<TabItem value="type">

```ts
declare type TorusStorageLayerArgs = {
  enableLogging?: boolean;
  hostUrl?: string; // use `https://metadata.tor.us` for connecting to the Torus Metadata Server
  serverTimeOffset?: number;
};
```

</TabItem>

</Tabs>

### Example

<StorageLayerTorusExample />

## Configuring Modules

---

<ModulesDescription />

### Example

<ModulesExample />

## Instantiating tKey

---

#### Import the `ThresholdKey` class from `@tkey/core`

```javascript
import ThresholdKey from "@tkey/core";
```

#### Assign the `ThresholdKey` class to a variable

```javascript
const tKey = new ThresholdKey(TKeyArgs);
```

This ThresholdKey constructor takes an object with `TKeyArgs` as input.

### Parameters

#### `TKeyArgs`

<Tabs
  defaultValue="table"
  values={[
    { label: "Table", value: "table" },
    { label: "Type Declaration", value: "type" },
  ]}
>

<TabItem value="table">

</TabItem>

<TabItem value="type">

```ts
declare type TKeyArgs = {
  enableLogging?: boolean;
  modules?: ModuleMap; // pass over the modules you want to use
  serviceProvider?: IServiceProvider; // pass over the service provider variable you instantiated
  storageLayer?: IStorageLayer; // pass over the storage layer variable you instantiated
  directParams?: CustomAuthArgs; // optional, but you can pass the directParams from Torus Service Provider here as well.
  manualSync?: boolean;
  serverTimeOffset?: number;
};

export declare type ModuleMap = {
  [moduleName: string]: IModule;
};
```

</TabItem>

</Tabs>

### Example

```js
const tKey = new ThresholdKey({
  serviceProvider: serviceProvider,
  storageLayer,
  modules: {
    webStorage: webStorageModule,
    securityQuestions: securityQuestionsModule,
    shareTransfer: shareTransferModule,
  },
});
```

## Initializing Torus Service Provider

---

:::note

This step is mandatory if you're using the Torus Service Provider and have instantiated it as [mentioned above](#torus-service-provider). If not, feel
free to ignore this step, but make sure to instantiate your preferred wallet so that while logging in and generating tkey, you can pass over the
private key to the base service provider.

:::

If you're using the Torus Service Provider, you need to initialize it within your constructor function so as to use it while logging your user in
through the social accounts. This is done by calling the `init()` function within the `tKey` instance's `serviceProvider` property.

:::tip

Checkout the [Service Provider Reference](./service-provider#initialization-1) to know more about `init()` and its configuration.

:::

### Example

```js
await (tKey.serviceProvider as TorusServiceProvider).init({ skipSw: false });
```

## Triggering Login using Torus Service Provider

---

Once you have initialised the Torus Service Provider, you're ready to trigger the login process. This is a needed step since this will generate a
private key which will be needed by the TKey to generate it's share. This is done by calling the `triggerLogin()` function within the `tKey`
instance's `serviceProvider` property.

:::tip

Checkout the [Service Provider Reference](./service-provider#triggering-login) to know more about `triggerLogin()` and its configuration.

:::

### Example

```js
const loginResponse = await (tKey.serviceProvider as TorusServiceProvider).triggerLogin({
    typeOfLogin: "google",
    verifier: "web3auth-testnet-verifier",
    clientId: "134678854652-vnm7amoq0p23kkpkfviveul9rb26rmgn.apps.googleusercontent.com",
});
```

## Initializing tKey

---

Once you have triggered the login process, you're ready to initialize the tKey. This will generate you a Threshold Key corresponding to your login
provider.

```ts
tKey.initialize(params?);
```

#### `params`

The `initialize` function accepts the following optional parameters:

<Tabs
  defaultValue="table"
  values={[
    { label: "Table", value: "table" },
    { label: "Interface", value: "interface" },
  ]}
>

<TabItem value="table">

</TabItem>

<TabItem value="interface">

```ts
initialize(params?: {
    withShare?: ShareStore;
    importKey?: BN;
    neverInitializeNewKey?: boolean;
    transitionMetadata?: Metadata;
    previouslyFetchedCloudMetadata?: Metadata;
    previousLocalMetadataTransitions?: LocalMetadataTransitions;
    delete1OutOf1?: boolean;
}): Promise<KeyDetails>;
```

</TabItem>

</Tabs>

### Example

```js
await tKey.initialize();
```

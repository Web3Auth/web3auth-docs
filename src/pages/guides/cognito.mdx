---
title: Using AWS Cognito with Web3Auth
image: "/docs/contents/guides/banners/cognito-banner.png"
description: Learn how to use Web3Auth with AWS Cognito in your React Application.
type: guide
tags: [ethereum, web3auth, cognito, react]
date: 25th June 2022
author: Mohammad Shahbaz Alam
order: 2
---

import TabItem from "@theme/TabItem";
import Tabs from "@theme/Tabs";

import SetupWeb3AuthDashboard from "../../content/guides/common/_setup_web3auth_dashboard.mdx";
import SetupBaseProject from "../../content/guides/common/_setup_base_project.mdx";
import Installation from "../../content/guides/common/_installation.mdx";
import Initialization from "../../content/guides/common/_initialization.mdx";
import InteractingWithBlockchain from "../../content/guides/common/_interacting_with_blockchain.mdx";

<head>
  <meta name="viewport" content="width=device-width" />
  <meta charSet="utf-8" />
  <meta property="og:site_name" content="Web3Auth" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="photo" />
  <meta name="twitter:site" content="@Web3Auth" />
  <meta name="twitter:creator" content="@Web3Auth" />
  <meta property="og:image" content="/docs/contents/guides/banners/cognito-banner.png" />
  <meta name="description" content="Learn how to use Web3Auth with AWS Cognito in your React Application." />
  <meta property="og:title" content="Using AWS Cognito with Web3Auth" />
  <meta property="og:description" content="Learn how to use Web3Auth with AWS Cognito in your React Application." />
  <meta property="og:url" content="https://web3auth.io/docs/guides/cognito" />
  <meta name="keywords" content="web3auth, cognito, aws cognito authentication, authentication, auth, web3, aws" />
</head>

This guide will cover the basics of how to set up your Web3Auth SDK and AWS Cognito for the integration and provide you with the links on how to
develop a basic web application on the Ethereum blockchain.

## Quick Start

```bash
git clone https://github.com/Web3Auth/examples.git
cd cognito-react-example
npm install
npm run start
```

## How it works?

---

<Tabs
defaultValue="SPA"
values={[
  { label: "SPA", value: "SPA" },
  { label: "RWA", value: "RWA" },
]}
>
<TabItem value="SPA">

When integrating Web3Auth with AWS Cognito the Implicit flow looks something like this:

> Recommended for Single Page Applications(SPA).

![AWS Cognito - Implicit Flow](/contents/guides/cognito/cognito-spa.png)

</TabItem>
<TabItem value="RWA">

When integrating Web3Auth with AWS Cognito the Authorization code flow looks something like this:

> Regular Web Applications (RWA)

![AWS Cognito - Authorization Code Flow](/contents/guides/cognito/cognito-rwa.png)

For Authorization code flow, you will need an additional backend server to communicate with AWS Cognito to get the `id_token` in exchange of
`authorization_code` received.

</TabItem>

</Tabs>

- When a user logs in with AWS Cognito, Cognito sends a JWT `id_token` to the app. This JWT token is sent to the Web3Auth SDK's login function.

- Finally, on successful validation of the JWT token, Web3Auth SDK will generate a private key for the user, in a self custodial way, resulting in
  easy onboarding for your user to the application.

## Prerequisites

---

- For Web Apps: A basic knowledge of JavaScript is required to use Web3Auth SDK.

- For Mobile Apps: For the Web3Auth Mobile SDKs, you have a choice between iOS, Android, React Native & Flutter. Please refer to the
  [Web3Auth API Reference](/api-reference) for more information.

- [Node](https://nodejs.org/en/download/) & npm installed to use `create-react-app`.

- An [AWS](https://aws.amazon.com/console) account to create AWS Cognito User Poll.

- A [Google Developer](https://console.developers.google.com) account to be used as Identity provider for AWS Cognito.

- Create a Web3Auth account on the [Web3Auth Dashboard](https://dashboard.web3auth.io)

## Setup

---

### Setup your AWS Cognito

- Go to your AWS account and go to [AWS Cognito](https://console.aws.amazon.com/cognito/home) console. And Create a new user pool by following
  [this AWS Console guide](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-console.html).

- Note down the `userPoolId` and `region` after creating the new user pool.

- Add a new app client to the user pool from App clients tab under General settings of your pool settings. Note down the `App client id` for this app
  client, that looks something like `3j2tXXXXkkff5ajpn`. We will use this as the `aud` value for the JWT validation field.

  ![AWS Cognito - Create app client](/contents/guides/cognito/cognito-create-app-client.png)

- Add a domain to your AWS Cognito App from `App integration > Domain name` section.

- We will use Google login as Identity provider in AWS Cognito for this guide.

  - Obtain the OAuth `Client ID` and `Client Secret` from your [Google Developer dashboard](https://console.developers.google.com). Follow Googleâ€™s
    instructions to [set up an OAuth 2.0 App](https://support.google.com/cloud/answer/6158849?hl=en).

  - While configuring your Google OAuth 2.0 client for web, make sure to enter
    - `<AWS_COGNITO_DOMAIN>` in the `Authorized Javascript Origins list` and,
    - `<AWS_COGNITO_DOMAIN>/oauth2/idpresponse` in the Authorized redirect URIs list.

- Let's configure Google login in AWS Cognito.

  - Go to identity providers tab under federation tab and select Google.
  - It will require you to enter your Google app's `Client ID` and `Client Secret` which you get in the above steps.
    - Paste `Client ID` in the Google app ID field.
    - Paste `Client Secret` in the App secret field.
    - Type `profile email openid` in the Authorize scope field.
      ![AWS Cognito - Google Login Identity configuration](/contents/guides/cognito/cognito-google-identity.png)
    - Your Google login provider is configured, you can enable it in your App client settings under App Integration settings of your pool settings.
      ![AWS Cognito - Enable Google Identity](/contents/guides/cognito/cognito-enable-google-identity.png)
    - **Map email from Google attribute to user pool attribute**.
      - In the Amazon Cognito console, choose Manage user pools, and then choose your user pool.
      - In the left navigation pane, under Federation, choose `Attribute mapping`.
      - On the attribute mapping page, choose the `Google` tab.
      - Next to the Google attribute named `email`, select the Capture check box.
      - Next to email, for User pool attribute, choose `Email` from the list.
      - Choose Save changes.

- Update App client settings to set the desired OAuth flow and redirect endpoints. For this guide, we will be using the _Implicit OAuth flow_.

  - Click on `App client settings` under **App integration**.
  - Callback URL(s): `http://localhost:3000/callback, https://beta.openlogin.com/auth`
  - Sign out URL(s): `http://localhost:3000`
    - Additional to your own URLs for the application, please add
      - [https://beta.openlogin.com/auth](https://beta.openlogin.com/auth) (for Web3Auth testnet used in demo applications) and
      - [https://app.openlogin.com/auth](https://app.openlogin.com/auth) (for Web3Auth mainnet used in production applications).
  - OAuth2.0
    - Select [x] `Implicit grant` from **Allowed OAuth Flows**
    - Select [x] `email` `openid` `profile` from **Allowed OAuth Scopes**
      ![AWS Cognito - App Client Settings Final](/contents/guides/cognito/cognito-final-app-client-settings.png)
  - **Save Changes** and your Cognito app is configured to use Web3Auth.

- Now lets configure Web3Auth using AWS Cognito app details.

### Setup your Web3Auth Dashboard

<SetupWeb3AuthDashboard />

- Create a **Verifier** from the **Custom Auth** Section of the [Web3Auth Developer Dashboard](https://dashboard.web3auth.io/) with following
  configuration:

  - Choose a name of your choice for the verifier identifier. `eg. aws-cognito-verifier`
  - Select environment: `testnet`, `mainnet` or `cyan` as per your requirement.
  - Select `Custom` from the **Login Provider**.
  - Select `Email` for the **JWT Verifier ID**.
  - Your JWK endpoint endpoint for aws cognito will look something like this:
    `https://cognito-idp.{region}.amazonaws.com/{userPoolId}/.well-known/jwks.json`. Get the `region` and `userPoolId` value from your AWS Cognito
    console.
  - JWT validation fields:
    - iss: `https://cognito-idp.{region}.amazonaws.com/{userPoolId}`.
    - aud: `App client id` the from AWS Cognito console.
  - Click on `Create` button to create your verifier. It may take up to 10 minutes to deploy verifier on _testnet_. You'll receive an email once it's
    complete.

  ![Custom Authentication - Create AWS Cognito Verifier](/contents/guides/cognito/cognito-create-verifier.png)

- You will require the `verifierName` of the newly created verifier and `clientId` of the Plug and Play Project.

## Using the Web3Auth SDK

---

To use the Web3Auth SDK, you need to add the dependency of the respective platform SDK of Web3Auth to your project. To know more about the available
SDKs, please have a look at this [documentation page](/developing-with-web3auth/understand-sdk).

For this guide here, we will be talking through the [Web3Auth Core SDK](/api-reference/web/core) and using the
[OpenLogin Provider](/api-reference/web/adapters/openlogin) alongside it to enable Custom Authentication through AWS Cognito.

<SetupBaseProject />

### Installation

<Installation />

### Initialization

<Initialization />

#### Custom Authentication (OpenLoginApadpter)

```js
const openloginAdapter = new OpenloginAdapter({
  adapterSettings: {
    clientId: "YOUR-WEB3AUTH-CLIENT-ID",
    network: "testnet",
    uxMode: "popup",
    loginConfig: {
      jwt: {
        name: "Name of your choice",
        verifier: "YOUR-VERIFIER-NAME-ON-WEB3AUTH-DASHBOARD",
        typeOfLogin: "jwt",
        clientId: "YOUR-CLIENTID-FROM-AWS-COGNITO-DASHBOARD",
      },
    },
  },
});

web3auth.configureAdapter(openloginAdapter);
```

Here, you need to pass over your Web3Auth `clientId` in the adapterSettings object and your Custom Auth `verifierName` and AWS Cognito `clientId` in
the loginConfig object. This makes sure that the Openlogin Adapter can connect to the correct verifier and AWS Cognito server.

#### Initialising the Web3Auth SDK

```js
await web3auth.init();
```

#### Initialising on Mobile Platforms

- For Mobile, depending on the platform, there will be different steps to initialize the SDK. Refer to the respective Mobile SDKs,
  - [Android](/api-reference/android/setting-up)
  - [iOS](/api-reference/ios/setting-up)
  - [Flutter](/api-reference/flutter/setting-up)
  - [React Native](/api-reference/react-native/setting-up).

### Authentication

#### Logging in

Once initialized, you can use the `connectTo()` function to authenticate the user when they click the login button.

```js
import { WALLET_ADAPTERS, CHAIN_NAMESPACES } from "@web3auth/base";

await web3auth.connectTo(WALLET_ADAPTERS.OPENLOGIN, {
  relogin: true,
  loginProvider: "jwt",
  extraLoginOptions: {
    domain: "YOUR-COGNITO-DOMAIN/oauth",
    verifierIdField: "email",
    response_type: "token",
    scope: "email profile openid",
  },
});
```

When connecting, your `connectTo` function takes the arguments for the adapter you want to connect to and the options for the login. The major thing
to note here is the `domain` option in the `extraLoginOptions` object. This is the domain of your AWS Cognito pool so that you can be redirected to
login there directly from the Web3Auth Core SDK.

### Get the User Profile

```js
const user = await web3auth.getUserInfo();
console.log("User info", user);
```

Using the `getUserInfo` function, you can get the details of the logged in user. Please note that these details are not stored anywhere in Web3Auth
network, but are fetched from the id_token you received from AWS Cognito and lives in the frontend context.

### Logout

```js
await web3auth.logout();
```

Logging out your user is as simple as calling the `logout` function.

> Note: Currently, Web3AuthCore SDK doesn't log out a user from AWS Cognito, so you can try calling this below endpoint to log out a user.

```js
window.open("
    YOUR-COGNITO-DOMAIN/logout?
    client_id=YOUR-CLIENTID-FROM-AWS-COGNITO-DASHBOARD&
    logout_uri=LOGOUT_URI&
    redirect_uri=REDIRECT_URI
");
```

### Interacting with Blockchain

<InteractingWithBlockchain />

## Example code

The code for this demo application can also be found in the
[Web3Auth Cognito Example](https://github.com/Web3Auth/examples/tree/main/cognito-react-example). Check it out and try running it locally yourself!
